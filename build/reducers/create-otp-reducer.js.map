{"version":3,"sources":["create-otp-reducer.js"],"names":["defaultConfig","autoPlan","debouncePlanTimeMs","realtimeEffectsDisplayThreshold","defaultQuery","routingType","queryParams","filter","qp","forEach","name","default","createOtpReducer","config","initialQuery","currentQuery","queryModes","mode","split","includes","m","concat","join","initialState","location","currentPosition","error","coords","fetching","sessionSearches","nearbyStops","searches","transitIndex","stops","trips","useRealtime","activeSearchId","overlay","bikeRental","stations","carRental","parkAndRide","locations","transit","zipcar","tnc","etaEstimates","rideEstimates","ui","mobileScreen","MobileScreens","WELCOME_SCREEN","diagramLeg","state","action","searchId","payload","type","activeItinerary","length","window","history","ui_activeItinerary","$set","activeLeg","activeStep","pending","query","response","nonRealtimeResponse","index","console","log","$merge","map","initLat","lat","initLon","lon","initZoom","zoom","elevationPoint","mapPopupLocation","position","$unshift","stopLookup","s","id","stopId","routes","mainPanelContent","viewedStop","viewedTrip","viewedRoute","tripId","stopTimes","geometry","routeId","patterns","patternId","from","fromData","estimates","estimate","company","productId","estimateTimestamp","Date","rideEstimate","to","rideType"],"mappings":"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","file":"create-otp-reducer.js","sourcesContent":["import clone from 'clone'\nimport update from 'immutability-helper'\n\nimport queryParams from '../util/query-params'\nimport { ensureSingleAccessMode } from '../util/query'\nimport { isTransit, getTransitModes } from '../util/itinerary'\nimport { filterProfileOptions } from '../util/profile'\nimport { MobileScreens } from '../actions/ui'\n\nconst defaultConfig = {\n  autoPlan: true,\n  debouncePlanTimeMs: 0,\n  realtimeEffectsDisplayThreshold: 120\n}\n\n// construct the initial/default query\nconst defaultQuery = { routingType: 'ITINERARY' }\nqueryParams.filter(qp => 'default' in qp).forEach(qp => {\n  defaultQuery[qp.name] = qp.default\n})\n\n// TODO: parse and merge URL query params w/ default query\n\n// TODO: fire planTrip action if default query is complete/error-free\n\nfunction createOtpReducer (config, initialQuery) {\n  // populate query by merging any provided query params w/ the default params\n  const currentQuery = Object.assign(defaultQuery, initialQuery)\n\n  let queryModes = currentQuery.mode.split(',')\n\n  // If 'TRANSIT' is included in the mode list, replace it with individual modes\n  if (queryModes.includes('TRANSIT')) {\n    // Isolate the non-transit modes in queryModes\n    queryModes = queryModes.filter(m => !isTransit(m))\n    // Add all possible transit modes\n    queryModes = queryModes.concat(getTransitModes(config))\n    // Stringify and set as OTP 'mode' query param\n    currentQuery.mode = queryModes.join(',')\n  }\n\n  // If we are in 'ITINERARY' mode, ensure that one and only one access mode is selected\n  if (currentQuery.routingType === 'ITINERARY') {\n    queryModes = ensureSingleAccessMode(queryModes)\n  }\n\n  const initialState = {\n    config: Object.assign(defaultConfig, config),\n    currentQuery,\n    location: {\n      currentPosition: {\n        error: null,\n        coords: null,\n        fetching: false\n      },\n      sessionSearches: [],\n      nearbyStops: []\n    },\n    searches: {},\n    transitIndex: {\n      stops: {},\n      trips: {}\n    },\n    useRealtime: true,\n    activeSearchId: 0,\n    overlay: {\n      bikeRental: {\n        stations: []\n      },\n      carRental: {\n        stations: []\n      },\n      parkAndRide: {\n        locations: []\n      },\n      transit: {\n        stops: []\n      },\n      zipcar: {\n        locations: []\n      }\n    },\n    tnc: {\n      etaEstimates: {},\n      rideEstimates: {}\n    },\n    ui: {\n      mobileScreen: MobileScreens.WELCOME_SCREEN,\n      diagramLeg: null\n    }\n  }\n\n  return (state = initialState, action) => {\n    const searchId = action.payload && action.payload.searchId\n    switch (action.type) {\n      case 'ROUTING_REQUEST':\n        // Compute the initial activeItinerary. If this is the first search of\n        // session (i.e. searches lookup is empty/null) AND an activeItinerary ID\n        // is specified in URL parameters, use that ID. Otherwise, use null/0\n        let activeItinerary = state.currentQuery.routingType === 'ITINERARY' ? 0 : null\n        if (\n          (!state.searches || Object.keys(state.searches).length === 0) &&\n          window.history.state && window.history.state.ui_activeItinerary\n        ) {\n          activeItinerary = window.history.state.ui_activeItinerary\n        }\n\n        return update(state, {\n          searches: {\n            [searchId]: {\n              $set: {\n                activeItinerary,\n                activeLeg: null,\n                activeStep: null,\n                pending: true,\n                query: clone(state.currentQuery),\n                response: null\n              }\n            }\n          },\n          activeSearchId: { $set: searchId }\n        })\n      case 'ROUTING_ERROR':\n        return update(state, {\n          searches: {\n            [searchId]: {\n              response: {\n                $set: {\n                  error: action.payload.error\n                }\n              },\n              pending: { $set: false }\n            }\n          }\n        })\n      case 'ROUTING_RESPONSE':\n        const response = (state.currentQuery.routingType === 'PROFILE')\n          ? filterProfileOptions(action.payload.response)\n          : action.payload.response\n\n        return update(state, {\n          searches: {\n            [searchId]: {\n              response: { $set: response },\n              pending: { $set: false }\n            }\n          },\n          ui: {\n            diagramLeg: { $set: false }\n          }\n        })\n      case 'NON_REALTIME_ROUTING_RESPONSE':\n        return update(state, {\n          searches: {\n            [searchId]: {\n              nonRealtimeResponse: { $set: action.payload.response }\n            }\n          }\n        })\n      case 'BIKE_RENTAL_REQUEST':\n        return update(state, {\n          overlay: {\n            bikeRental: {\n              pending: { $set: true },\n              error: { $set: null }\n            }\n          }\n        })\n      case 'BIKE_RENTAL_ERROR':\n        return update(state, {\n          overlay: {\n            bikeRental: {\n              pending: { $set: false },\n              error: { $set: action.payload }\n            }\n          }\n        })\n      case 'BIKE_RENTAL_RESPONSE':\n        return update(state, {\n          overlay: {\n            bikeRental: {\n              stations: { $set: action.payload.stations },\n              pending: { $set: false }\n            }\n          }\n        })\n      case 'CAR_RENTAL_ERROR':\n        return update(state, {\n          overlay: {\n            carRental: {\n              pending: { $set: false },\n              error: { $set: action.payload }\n            }\n          }\n        })\n      case 'CAR_RENTAL_RESPONSE':\n        return update(state, {\n          overlay: {\n            carRental: {\n              stations: { $set: action.payload.stations },\n              pending: { $set: false }\n            }\n          }\n        })\n      case 'SET_USE_REALTIME_RESPONSE':\n        return update(state, {\n          useRealtime: { $set: action.payload.useRealtime }\n        })\n      case 'SET_ACTIVE_ITINERARY':\n        if (state.activeSearchId !== null) {\n          return update(state, {\n            searches: {\n              [state.activeSearchId]: {\n                activeItinerary: { $set: action.payload.index },\n                activeLeg: { $set: null },\n                activeStep: { $set: null }\n              }\n            }\n          })\n        }\n        return state\n      case 'SET_ACTIVE_LEG':\n        if (state.activeSearchId !== null) {\n          return update(state, {\n            searches: {\n              [state.activeSearchId]: {\n                activeLeg: { $set: action.payload.index },\n                activeStep: { $set: null }\n              }\n            }\n          })\n        }\n        return state\n      case 'SET_ACTIVE_STEP':\n        if (state.activeSearchId !== null) {\n          return update(state, {\n            searches: {\n              [state.activeSearchId]: {\n                activeStep: { $set: action.payload.index }\n              }\n            }\n          })\n        }\n        return state\n      case 'SET_LOCATION':\n        return update(state, {\n          currentQuery: {\n            [action.payload.type]: { $set: action.payload.location }\n          }\n        })\n      case 'CLEAR_LOCATION':\n        return update(state, {\n          currentQuery: { [action.payload.type]: { $set: null } }\n        })\n\n      case 'SET_QUERY_PARAM':\n        console.log('merging QPs', action.payload)\n        return update(state, { currentQuery: { $merge: action.payload } })\n      case 'FORM_CHANGED':\n        return update(state, { activeSearchId: { $set: null } })\n\n      case 'SET_AUTOPLAN':\n        return update(state, {\n          config: { autoPlan: { $set: action.payload.autoPlan } }\n        })\n      case 'SET_MAP_CENTER':\n        return update(state, {\n          config: {\n            map: {\n              initLat: { $set: action.payload.lat },\n              initLon: { $set: action.payload.lon }\n            }\n          }\n        })\n      case 'SET_MAP_ZOOM':\n        return update(state, {\n          config: {\n            map: {\n              initZoom: { $set: action.payload.zoom }\n            }\n          }\n        })\n      case 'SHOW_LEG_DIAGRAM':\n        return update(state, {\n          ui: {\n            diagramLeg: { $set: action.payload }\n          }\n        })\n      case 'SET_ELEVATION_POINT':\n        return update(state, {\n          ui: {\n            elevationPoint: { $set: action.payload }\n          }\n        })\n      case 'SET_MAP_POPUP_LOCATION':\n        return update(state, {\n          ui: {\n            mapPopupLocation: { $set: action.payload.location }\n          }\n        })\n      case 'POSITION_FETCHING':\n        return update(state, {\n          location: {\n            currentPosition: { $merge: { fetching: action.payload.type } }\n          }\n        })\n      case 'POSITION_ERROR':\n        return update(state, {\n          location: { currentPosition: { $set: action.payload } }\n        })\n      case 'POSITION_RESPONSE':\n        return update(state, {\n          location: { currentPosition: { $set: action.payload.position } }\n        })\n      case 'ADD_LOCATION_SEARCH':\n        return update(state, {\n          location: { sessionSearches: { $unshift: [action.payload.location] } }\n        })\n\n      case 'NEARBY_STOPS_RESPONSE':\n        const stopLookup = {}\n        action.payload.stops.forEach(s => {\n          stopLookup[s.id] = s\n        })\n        return update(state, {\n          location: {\n            nearbyStops: { $set: action.payload.stops.map(s => s.id) }\n          },\n          transitIndex: { stops: { $merge: stopLookup } }\n        })\n      case 'STOPS_WITHIN_BBOX_RESPONSE':\n        return update(state, {\n          overlay: {\n            transit: {\n              stops: { $set: action.payload.stops },\n              pending: { $set: false }\n            }\n          }\n        })\n      case 'CLEAR_STOPS_OVERLAY':\n        return update(state, {\n          overlay: {\n            transit: {\n              stops: { $set: [] },\n              pending: { $set: false }\n            }\n          }\n        })\n      case 'ROUTES_AT_STOP_RESPONSE':\n        return update(state, {\n          transitIndex: {\n            stops: {\n              [action.payload.stopId]: {\n                routes: { $set: action.payload.routes }\n              }\n            }\n          }\n        })\n      case 'SET_MOBILE_SCREEN':\n        return update(state, { ui: { mobileScreen: { $set: action.payload } } })\n      case 'SET_MAIN_PANEL_CONTENT':\n        return update(state, {\n          ui: { mainPanelContent: { $set: action.payload } }\n        })\n      case 'SET_VIEWED_STOP':\n        return update(state, { ui: { viewedStop: { $set: action.payload } } })\n      case 'CLEAR_VIEWED_STOP':\n        return update(state, { ui: { viewedStop: { $set: null } } })\n\n      case 'SET_VIEWED_TRIP':\n        return update(state, { ui: { viewedTrip: { $set: action.payload } } })\n      case 'CLEAR_VIEWED_TRIP':\n        return update(state, { ui: { viewedTrip: { $set: null } } })\n\n      case 'SET_VIEWED_ROUTE':\n        return update(state, { ui: { viewedRoute: { $set: action.payload } } })\n\n      case 'FIND_STOP_RESPONSE':\n        return update(state, {\n          transitIndex: {\n            stops: { [action.payload.id]: { $set: action.payload } }\n          }\n        })\n      case 'FIND_TRIP_RESPONSE':\n        return update(state, {\n          transitIndex: {\n            trips: { [action.payload.id]: { $set: action.payload } }\n          }\n        })\n      case 'FIND_STOPS_FOR_TRIP_RESPONSE':\n        return update(state, {\n          transitIndex: {\n            trips: {\n              [action.payload.tripId]: { stops: { $set: action.payload.stops } }\n            }\n          }\n        })\n      case 'FIND_STOP_TIMES_FOR_TRIP_RESPONSE':\n        return update(state, {\n          transitIndex: {\n            trips: {\n              [action.payload.tripId]: {\n                stopTimes: { $set: action.payload.stopTimes }\n              }\n            }\n          }\n        })\n      case 'FIND_GEOMETRY_FOR_TRIP_RESPONSE':\n        return update(state, {\n          transitIndex: {\n            trips: {\n              [action.payload.tripId]: {\n                geometry: { $set: action.payload.geometry }\n              }\n            }\n          }\n        })\n      case 'FIND_STOP_TIMES_FOR_STOP_RESPONSE':\n        return update(state, {\n          transitIndex: {\n            stops: {\n              [action.payload.stopId]: {\n                stopTimes: { $set: action.payload.stopTimes }\n              }\n            }\n          }\n        })\n      case 'FIND_ROUTES_RESPONSE':\n        return update(state, {\n          transitIndex: { routes: { $set: action.payload } }\n        })\n      case 'FIND_ROUTE_RESPONSE':\n        return update(state, {\n          transitIndex: {\n            routes: { [action.payload.id]: { $set: action.payload } }\n          }\n        })\n      case 'FIND_PATTERNS_FOR_ROUTE_RESPONSE':\n        return update(state, {\n          transitIndex: {\n            routes: {\n              [action.payload.routeId]: {\n                patterns: { $set: action.payload.patterns }\n              }\n            }\n          }\n        })\n      case 'FIND_GEOMETRY_FOR_PATTERN_RESPONSE':\n        return update(state, {\n          transitIndex: {\n            routes: {\n              [action.payload.routeId]: {\n                patterns: {\n                  [action.payload.patternId]: {\n                    geometry: { $set: action.payload.geometry }\n                  }\n                }\n              }\n            }\n          }\n        })\n      case 'TNC_ETA_RESPONSE':\n        return update(state, {\n          tnc: {\n            etaEstimates: {\n              [action.payload.from]: fromData => {\n                fromData = Object.assign({}, fromData)\n                const estimates = action.payload.estimates || []\n                estimates.forEach(estimate => {\n                  if (!fromData[estimate.company]) {\n                    fromData[estimate.company] = {}\n                  }\n                  fromData[estimate.company][estimate.productId] = Object.assign(\n                    {\n                      estimateTimestamp: new Date()\n                    },\n                    estimate\n                  )\n                })\n                return fromData\n              }\n            }\n          }\n        })\n      case 'TNC_RIDE_RESPONSE':\n        return update(state, {\n          tnc: {\n            rideEstimates: {\n              [action.payload.from]: fromData => {\n                fromData = Object.assign({}, fromData)\n                const {company, rideEstimate, to} = action.payload\n                if (!rideEstimate) {\n                  return fromData\n                }\n                if (!fromData[to]) {\n                  fromData[to] = {}\n                }\n                if (!fromData[to][company]) {\n                  fromData[to][company] = {}\n                }\n                fromData[to][company][rideEstimate.rideType] = Object.assign(\n                  {\n                    estimateTimestamp: new Date()\n                  },\n                  rideEstimate\n                )\n                return fromData\n              }\n            }\n          }\n        })\n\n      case 'PARK_AND_RIDE_RESPONSE':\n        return update(state, {\n          overlay: {\n            parkAndRide: {\n              locations: { $set: action.payload },\n              pending: { $set: false }\n            }\n          }\n        })\n\n      // TODO: can this be broken out into a separate module?\n      case 'ZIPCAR_LOCATIONS_RESPONSE':\n        return update(state, {\n          overlay: {\n            zipcar: {\n              locations: { $set: action.payload.locations },\n              pending: { $set: false }\n            }\n          }\n        })\n\n      default:\n        return state\n    }\n  }\n}\n\nexport default createOtpReducer\n"]}