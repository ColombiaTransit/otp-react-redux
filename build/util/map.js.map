{"version":3,"sources":["map.js"],"names":["latlngToString","coordsToString","stringToCoords","constructLocation","itineraryToTransitive","isBikeshareStation","latlng","lat","toFixed","lng","lon","coords","length","map","c","join","str","split","name","itin","includeGeometry","tdata","journeys","streetEdges","places","patterns","routes","stops","streetEdgeId","patternId","journey","journey_id","journey_name","segments","push","place_id","place_lat","legs","from","place_lon","to","forEach","leg","mode","fromPlaceId","toPlaceId","rentedBike","bikeShareId","segment","type","hailedCar","arc","edge_id","geometry","legGeometry","place_name","hasInterStopGeometry","interStopGeometry","intermediateStops","ptnId","pattern","pattern_id","pattern_name","route_id","routeId","stopId","stop_id","stop_name","stop_lat","stop_lon","entries","i","stop","points","agency_id","agencyId","route_short_name","routeShortName","route_long_name","routeLongName","route_type","routeType","route_color","routeColor","from_stop_index","to_stop_index","k","place","lastIndexOf"],"mappings":"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","file":"map.js","sourcesContent":["import { isTransit } from './itinerary'\n\nexport function latlngToString (latlng) {\n  return latlng && `${latlng.lat.toFixed(5)}, ${(latlng.lng || latlng.lon).toFixed(5)}`\n}\n\nexport function coordsToString (coords) {\n  return coords.length && coords.map(c => (+c).toFixed(5)).join(', ')\n}\n\nexport function stringToCoords (str) {\n  return (str && str.split(',').map(c => +c)) || []\n}\n\nexport function constructLocation (latlng) {\n  return {\n    name: latlngToString(latlng),\n    lat: latlng.lat,\n    lon: latlng.lng\n  }\n}\n\nexport function itineraryToTransitive (itin, includeGeometry) {\n  // console.log('itineraryToTransitive', itin);\n  const tdata = {\n    journeys: [],\n    streetEdges: [],\n    places: [],\n    patterns: [],\n    routes: [],\n    stops: []\n  }\n  const routes = {}\n  const stops = {}\n  let streetEdgeId = 0\n  let patternId = 0\n\n  const journey = {\n    journey_id: 'itin',\n    journey_name: 'Iterarary-derived Journey',\n    segments: []\n  }\n\n  // add 'from' and 'to' places to the tdata places array\n  tdata.places.push({\n    place_id: 'from',\n    place_lat: itin.legs[0].from.lat,\n    place_lon: itin.legs[0].from.lon\n  })\n  tdata.places.push({\n    place_id: 'to',\n    place_lat: itin.legs[itin.legs.length - 1].to.lat,\n    place_lon: itin.legs[itin.legs.length - 1].to.lon\n  })\n\n  itin.legs.forEach(leg => {\n    if (leg.mode === 'WALK' || leg.mode === 'BICYCLE' || leg.mode === 'CAR') {\n      let fromPlaceId, toPlaceId\n      if (leg.rentedBike) {\n        fromPlaceId = `bicycle_rent_station_${leg.from.bikeShareId}`\n        toPlaceId = `bicycle_rent_station_${leg.to.bikeShareId}`\n      } else {\n        fromPlaceId = `itin_street_${streetEdgeId}_from`\n        toPlaceId = `itin_street_${streetEdgeId}_to`\n      }\n\n      const segment = {\n        type: leg.mode,\n        streetEdges: [streetEdgeId],\n        from: { type: 'PLACE', place_id: fromPlaceId },\n        to: { type: 'PLACE', place_id: toPlaceId }\n      }\n      // For TNC segments, draw using an arc\n      if (leg.mode === 'CAR' && leg.hailedCar) segment.arc = true\n      journey.segments.push(segment)\n\n      tdata.streetEdges.push({\n        edge_id: streetEdgeId,\n        geometry: leg.legGeometry\n      })\n      tdata.places.push({\n        place_id: fromPlaceId,\n        place_name: leg.from.name,\n        place_lat: leg.from.lat,\n        place_lon: leg.from.lon\n      })\n      tdata.places.push({\n        place_id: toPlaceId,\n        place_name: leg.to.name,\n        place_lat: leg.to.lat,\n        place_lon: leg.to.lon\n      })\n      streetEdgeId++\n    }\n    if (isTransit(leg.mode)) {\n      // determine if we have valid inter-stop geometry\n      const hasInterStopGeometry =\n        leg.interStopGeometry &&\n        leg.interStopGeometry.length === leg.intermediateStops.length + 1\n\n      // create leg-specific pattern\n      const ptnId = 'ptn_' + patternId\n      const pattern = {\n        pattern_id: ptnId,\n        pattern_name: 'Pattern ' + patternId,\n        route_id: leg.routeId,\n        stops: []\n      }\n\n      // add 'from' stop to stops dictionary and pattern object\n      stops[leg.from.stopId] = {\n        stop_id: leg.from.stopId,\n        stop_name: leg.from.name,\n        stop_lat: leg.from.lat,\n        stop_lon: leg.from.lon\n      }\n      pattern.stops.push({ stop_id: leg.from.stopId })\n\n      // add intermediate stops to stops dictionary and pattern object\n      for (const [i, stop] of leg.intermediateStops.entries()) {\n        stops[stop.stopId] = {\n          stop_id: stop.stopId,\n          stop_name: stop.name,\n          stop_lat: stop.lat,\n          stop_lon: stop.lon\n        }\n        pattern.stops.push({\n          stop_id: stop.stopId,\n          geometry: hasInterStopGeometry && leg.interStopGeometry[i].points\n        })\n      }\n\n      // add 'to' stop to stops dictionary and pattern object\n      stops[leg.to.stopId] = {\n        stop_id: leg.to.stopId,\n        stop_name: leg.to.name,\n        stop_lat: leg.to.lat,\n        stop_lon: leg.to.lon\n      }\n      pattern.stops.push({\n        stop_id: leg.to.stopId,\n        geometry: hasInterStopGeometry && leg.interStopGeometry[leg.interStopGeometry.length - 1].points\n      })\n\n      // add route to the route dictionary\n      routes[leg.routeId] = {\n        agency_id: leg.agencyId,\n        route_id: leg.routeId,\n        route_short_name: leg.routeShortName || '',\n        route_long_name: leg.routeLongName || '',\n        route_type: leg.routeType,\n        route_color: leg.routeColor\n      }\n\n      // add the pattern to the tdata patterns array\n      tdata.patterns.push(pattern)\n\n      // add the pattern refrerence to the journey object\n      journey.segments.push({\n        type: 'TRANSIT',\n        patterns: [{\n          pattern_id: ptnId,\n          from_stop_index: 0,\n          to_stop_index: (leg.intermediateStops.length + 2) - 1\n        }]\n      })\n\n      patternId++\n    }\n  })\n\n  // add the routes and stops to the tdata arrays\n  for (const k in routes) tdata.routes.push(routes[k])\n  for (const k in stops) tdata.stops.push(stops[k])\n\n  // add the journey to the tdata journeys array\n  tdata.journeys.push(journey)\n\n  // console.log('derived tdata', tdata);\n  return tdata\n}\n\nexport function isBikeshareStation (place) {\n  return place.place_id.lastIndexOf('bicycle_rent_station') !== -1\n}\n"]}