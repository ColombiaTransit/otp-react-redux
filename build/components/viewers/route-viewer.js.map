{"version":3,"sources":["route-viewer.js"],"names":["operatorIndexForRoute","transitOperators","route","agency","index","findIndex","o","id","toLowerCase","split","order","getContrastYIQ","hexcolor","replace","r","parseInt","substr","g","b","yiq","RouteViewer","props","setMainPanelContent","findRoutes","findRoute","hideBackButton","languageConfig","routes","setViewedRoute","viewedRoute","sortedRoutes","Object","values","sort","coreUtils","itinerary","routeComparator","agencySortedRoutes","length","a","_backClicked","routeViewer","routeViewerDetails","clear","map","routeId","Component","PropTypes","bool","object","RouteRow","isActive","operator","defaultRouteColor","defaultRouteTextColor","longNameSplitter","backgroundColor","color","contrastColor","textColor","longName","nameParts","shortName","borderBottom","padding","width","_onClick","display","marginTop","fontSize","fontWeight","animation","url","PureComponent","mapStateToProps","state","ownProps","otp","config","transitIndex","ui","language","mapDispatchToProps"],"mappings":"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","sourcesContent":["import coreUtils from '@opentripplanner/core-utils'\nimport React, { Component, PureComponent } from 'react'\nimport PropTypes from 'prop-types'\nimport { Label, Button } from 'react-bootstrap'\nimport { VelocityTransitionGroup } from 'velocity-react'\nimport { connect } from 'react-redux'\n\nimport Icon from '../narrative/icon'\n\nimport { setMainPanelContent, setViewedRoute } from '../../actions/ui'\nimport { findRoutes, findRoute } from '../../actions/api'\n\nfunction operatorIndexForRoute (transitOperators, route) {\n  if (!route.agency) return 0\n  const index = transitOperators.findIndex(o =>\n    o.id.toLowerCase() === route.agency.id.split(':')[0].toLowerCase())\n  if (index !== -1 && typeof transitOperators[index].order !== 'undefined') return transitOperators[index].order\n  else return 0\n}\n\n/**\n * Determine the appropriate contrast color for text (white or black) based on\n * the input hex string (e.g., '#ff00ff') value.\n *\n * From https://stackoverflow.com/a/11868398/915811\n *\n * TODO: Move to @opentripplanner/core-utils once otp-rr uses otp-ui library.\n */\nfunction getContrastYIQ (hexcolor) {\n  hexcolor = hexcolor.replace('#', '')\n  const r = parseInt(hexcolor.substr(0, 2), 16)\n  const g = parseInt(hexcolor.substr(2, 2), 16)\n  const b = parseInt(hexcolor.substr(4, 2), 16)\n  const yiq = ((r * 299) + (g * 587) + (b * 114)) / 1000\n  return (yiq >= 128) ? '000000' : 'ffffff'\n}\n\nclass RouteViewer extends Component {\n  static propTypes = {\n    hideBackButton: PropTypes.bool,\n    routes: PropTypes.object\n  }\n\n  _backClicked = () => this.props.setMainPanelContent(null)\n\n  componentDidMount () {\n    this.props.findRoutes()\n  }\n\n  render () {\n    const {\n      findRoute,\n      hideBackButton,\n      languageConfig,\n      transitOperators,\n      routes,\n      setViewedRoute,\n      viewedRoute\n    } = this.props\n    const sortedRoutes = routes\n      ? Object.values(routes).sort(coreUtils.itinerary.routeComparator)\n      : []\n    const agencySortedRoutes = transitOperators.length > 0\n      ? sortedRoutes.sort((a, b) => {\n        return operatorIndexForRoute(transitOperators, a) - operatorIndexForRoute(transitOperators, b)\n      })\n      : sortedRoutes\n    return (\n      <div className='route-viewer'>\n        {/* Header Block */}\n        <div className='route-viewer-header'>\n          {/* Back button */}\n          {!hideBackButton && (\n            <div className='back-button-container'>\n              <Button\n                bsSize='small'\n                onClick={this._backClicked}\n              ><Icon type='arrow-left' />Back</Button>\n            </div>\n          )}\n\n          {/* Header Text */}\n          <div className='header-text'>\n            {languageConfig.routeViewer || 'Route Viewer'}\n          </div>\n          <div className=''>\n            {languageConfig.routeViewerDetails}\n          </div>\n          <div style={{ clear: 'both' }} />\n        </div>\n\n        <div className='route-viewer-body'>\n          {agencySortedRoutes\n            .map(route => {\n              // Find operator based on agency_id (extracted from OTP route ID).\n              // TODO: re-implement multi-agency logos for route viewer.\n              // const operator = operatorForRoute(transitOperators, route) || {}\n              return (\n                <RouteRow\n                  findRoute={findRoute}\n                  isActive={viewedRoute && viewedRoute.routeId === route.id}\n                  key={route.id}\n                  // operator={operator}\n                  route={route}\n                  setViewedRoute={setViewedRoute}\n                />\n              )\n            })\n          }\n        </div>\n      </div>\n    )\n  }\n}\n\nclass RouteRow extends PureComponent {\n  _onClick = () => {\n    const { findRoute, isActive, route, setViewedRoute } = this.props\n    if (isActive) {\n      // Deselect current route if active.\n      setViewedRoute({ routeId: null })\n    } else {\n      // Otherwise, set active and fetch route patterns.\n      findRoute({ routeId: route.id })\n      setViewedRoute({ routeId: route.id })\n    }\n  }\n\n  render () {\n    const {isActive, route, operator} = this.props\n    const {defaultRouteColor, defaultRouteTextColor, longNameSplitter} = operator || {}\n    const backgroundColor = `#${defaultRouteColor || route.color || 'ffffff'}`\n    // NOTE: text color is not a part of short response route object, so there\n    // is no way to determine from OTP what the text color should be if the\n    // background color is, say, black. Instead, determine the appropriate\n    // contrast color and use that if no text color is available.\n    const contrastColor = getContrastYIQ(backgroundColor)\n    const color = `#${defaultRouteTextColor || route.textColor || contrastColor}`\n    // Default long name is empty string (long name is an optional GTFS value).\n    let longName = ''\n    if (route.longName) {\n      // Attempt to split route name if splitter is defined for operator (to\n      // remove short name value from start of long name value).\n      const nameParts = route.longName.split(longNameSplitter)\n      longName = (longNameSplitter && nameParts.length > 1)\n        ? nameParts[1]\n        : route.longName\n      // If long name and short name are identical, set long name to be an empty\n      // string.\n      if (longName === route.shortName) longName = ''\n    }\n    return (\n      <div\n        style={{\n          borderBottom: '1px solid gray',\n          backgroundColor: isActive ? '#f6f8fa' : 'white'\n        }}>\n        <Button className='clear-button-formatting' style={{ padding: 8, width: '100%' }}\n          onClick={this._onClick}\n        >\n          <div style={{display: 'inline-block'}}>\n            {// TODO: re-implement multi-agency logos for route viewer.\n              // Currently, the agency object is not nested within the get all\n              // routes endpoint and causing this to only display transitOperators for\n              // the selected route.\n              // operator && <img src={operator.logo} style={{marginRight: '5px'}} height={25} />\n            }\n          </div>\n          <div style={{display: 'inline-block', marginTop: '2px'}}>\n            <Label\n              style={{\n                backgroundColor: backgroundColor === '#ffffff' ? 'rgba(0,0,0,0)' : backgroundColor,\n                fontSize: 'medium',\n                fontWeight: 400,\n                color\n              }}>\n              <b>{route.shortName}</b> {longName}\n            </Label>\n          </div>\n        </Button>\n        <VelocityTransitionGroup enter={{animation: 'slideDown'}} leave={{animation: 'slideUp'}}>\n          {isActive && (\n            <div style={{ padding: 8 }}>\n              {route.url\n                ? <a href={route.url} target='_blank'>Route Details</a>\n                : 'No route URL provided.'\n              }\n            </div>\n          )}\n        </VelocityTransitionGroup>\n      </div>\n    )\n  }\n}\n// connect to redux store\n\nconst mapStateToProps = (state, ownProps) => {\n  return {\n    transitOperators: state.otp.config.transitOperators,\n    routes: state.otp.transitIndex.routes,\n    viewedRoute: state.otp.ui.viewedRoute,\n    languageConfig: state.otp.config.language\n  }\n}\n\nconst mapDispatchToProps = {\n  findRoute,\n  findRoutes,\n  setMainPanelContent,\n  setViewedRoute\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(RouteViewer)\n"]}