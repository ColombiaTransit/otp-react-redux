{"version":3,"sources":["vehicle-rental-overlay.js"],"names":["VehicleRentalOverlay","props","refreshVehicles","_refreshTimer","setInterval","clearInterval","visible","_startRefreshing","_stopRefreshing","nextProps","stations","companies","filteredStations","filter","station","networks","includes","value","length","map","stationName","join","name","id","className","toLowerCase","markerIcon","iconSize","popupAnchor","html","y","x","context","lat","lon","setLocation","Component","propTypes","queryMode","PropTypes","string","vehicles","array","func","mapStateToProps","state","ownProps","otp","overlay","vehicleRental","mapDispatchToProps","vehicleRentalQuery"],"mappings":"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","file":"vehicle-rental-overlay.js","sourcesContent":["import React, { Component, PropTypes } from 'react'\nimport { connect } from 'react-redux'\nimport { FeatureGroup, Marker, Popup } from 'react-leaflet'\nimport { divIcon } from 'leaflet'\n\nimport SetFromToButtons from './set-from-to'\nimport { vehicleRentalQuery } from '../../actions/api'\nimport { setLocation } from '../../actions/map'\n\nclass VehicleRentalOverlay extends Component {\n  static propTypes = {\n    queryMode: PropTypes.string,\n    vehicles: PropTypes.array,\n    refreshVehicles: PropTypes.func\n  }\n\n  _startRefreshing () {\n    // ititial station retrieval\n    this.props.refreshVehicles()\n\n    // set up timer to refresh stations periodically\n    this._refreshTimer = setInterval(() => {\n      this.props.refreshVehicles()\n    }, 30000) // defaults to every 30 sec. TODO: make this configurable?*/\n  }\n\n  _stopRefreshing () {\n    if (this._refreshTimer) clearInterval(this._refreshTimer)\n  }\n\n  componentDidMount () {\n    if (this.props.visible) this._startRefreshing()\n  }\n\n  componentWillUnmount () {\n    this._stopRefreshing()\n  }\n\n  componentWillReceiveProps (nextProps) {\n    if (!this.props.visible && nextProps.visible) {\n      this._startRefreshing()\n    } else if (this.props.visible && !nextProps.visible) {\n      this._stopRefreshing()\n    }\n  }\n\n  render () {\n    const { stations, companies } = this.props\n\n    let filteredStations = stations\n    if (companies) {\n      filteredStations = stations.filter(\n        station => station.networks.filter(value => companies.includes(value)).length > 0\n      )\n    }\n\n    if (!filteredStations || filteredStations.length === 0) return <FeatureGroup />\n\n    return (\n      <FeatureGroup>\n        {filteredStations.map((station) => {\n          const stationName = `${station.networks.join('/')} ${station.name || station.id}`\n\n          let className = 'fa fa-map-marker vehicle-rental-icon'\n          // If this station is exclusive to a single network, apply the the class for that network\n          if (station.networks.length === 1) className += ' vehicle-rental-icon-' + station.networks[0].toLowerCase()\n          const markerIcon = divIcon({\n            iconSize: [11, 16],\n            popupAnchor: [0, -6],\n            html: '<i />',\n            className\n          })\n\n          return (\n            <Marker\n              icon={markerIcon}\n              key={station.id}\n              position={[station.y, station.x]}\n            >\n              <Popup>\n                <div className='map-overlay-popup'>\n                  {/* Popup title */}\n                  <div className='popup-title'>\n                    {stationName}\n                  </div>\n\n                  {/* Set as from/to toolbar */}\n                  <div className='popup-row'>\n                    <SetFromToButtons\n                      map={this.context.map}\n                      location={{\n                        lat: station.y,\n                        lon: station.x,\n                        name: stationName\n                      }}\n                      setLocation={this.props.setLocation}\n                    />\n                  </div>\n                </div>\n              </Popup>\n            </Marker>\n          )\n        })}\n      </FeatureGroup>\n    )\n  }\n}\n\n// connect to the redux store\n\nconst mapStateToProps = (state, ownProps) => {\n  return {\n    stations: state.otp.overlay.vehicleRental.stations\n  }\n}\n\nconst mapDispatchToProps = {\n  refreshVehicles: vehicleRentalQuery,\n  setLocation\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(VehicleRentalOverlay)\n"]}