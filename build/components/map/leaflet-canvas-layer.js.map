{"version":3,"sources":["leaflet-canvas-layer.js"],"names":["L","DomUtil","setTransform","el","offset","scale","pos","Point","style","TRANSFORM","Browser","ie3d","x","y","CanvasLayer","Layer","Class","extend","initialize","options","_map","_canvas","_frame","_delegate","setOptions","delegate","del","needRedraw","Util","requestAnimFrame","drawLayer","_onLayerDidResize","resizeEvent","width","newSize","height","_onLayerDidMove","topLeft","containerPointToLayerPoint","setPosition","getEvents","events","resize","moveend","zoom","zoomAnimation","any3d","zoomanim","_animateZoom","onAdd","map","create","tiles","size","getSize","animated","addClass","_panes","overlayPane","appendChild","on","onLayerDidMount","onRemove","onLayerWillUnmount","getPanes","removeChild","off","addTo","addLayer","LatLonToMercator","latlon","lng","Math","PI","log","tan","lat","bounds","getBounds","getZoom","center","getCenter","corner","containerPointToLatLng","onDrawLayer","layer","canvas","_setTransform","e","getZoomScale","_latLngBoundsToNewLayerBounds","min","_getCenterOffset","_multiplyBy","subtract","_getMapPanePos","canvasLayer"],"mappings":"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","file":"leaflet-canvas-layer.js","sourcesContent":["/*\n  Generic  Canvas Layer for leaflet 0.7 and 1.0-rc,\n  copyright Stanislav Sumbera,  2016 , sumbera.com , license MIT\n  originally created and motivated by L.CanvasOverlay  available here: https://gist.github.com/Sumbera/11114288\n\n*/\n\n// -- L.DomUtil.setTransform from leaflet 1.0.0 to work on 0.0.7\n//------------------------------------------------------------------------------\nL.DomUtil.setTransform = L.DomUtil.setTransform || function (el, offset, scale) {\n    var pos = offset || new L.Point(0, 0);\n\n    el.style[L.DomUtil.TRANSFORM] =\n        (L.Browser.ie3d ?\n            'translate(' + pos.x + 'px,' + pos.y + 'px)' :\n            'translate3d(' + pos.x + 'px,' + pos.y + 'px,0)') +\n        (scale ? ' scale(' + scale + ')' : '');\n};\n\n// -- support for both  0.0.7 and 1.0.0 rc2 leaflet\nL.CanvasLayer = (L.Layer ? L.Layer : L.Class).extend({\n    // -- initialized is called on prototype\n    initialize: function (options) {\n        this._map    = null;\n        this._canvas = null;\n        this._frame  = null;\n        this._delegate = null;\n        L.setOptions(this, options);\n    },\n\n    delegate :function(del){\n        this._delegate = del;\n        return this;\n    },\n\n    needRedraw: function () {\n        if (!this._frame) {\n            this._frame = L.Util.requestAnimFrame(this.drawLayer, this);\n        }\n        return this;\n    },\n\n    //-------------------------------------------------------------\n    _onLayerDidResize: function (resizeEvent) {\n        this._canvas.width = resizeEvent.newSize.x;\n        this._canvas.height = resizeEvent.newSize.y;\n    },\n    //-------------------------------------------------------------\n    _onLayerDidMove: function () {\n        var topLeft = this._map.containerPointToLayerPoint([0, 0]);\n        L.DomUtil.setPosition(this._canvas, topLeft);\n        this.drawLayer();\n    },\n    //-------------------------------------------------------------\n    getEvents: function () {\n        var events = {\n            resize: this._onLayerDidResize,\n            moveend: this._onLayerDidMove,\n            zoom: this._onLayerDidMove\n        };\n        if (this._map.options.zoomAnimation && L.Browser.any3d) {\n            events.zoomanim =  this._animateZoom;\n        }\n\n        return events;\n    },\n    //-------------------------------------------------------------\n    onAdd: function (map) {\n        this._map = map;\n        this._canvas = L.DomUtil.create('canvas', 'leaflet-layer');\n        this.tiles = {};\n\n        var size = this._map.getSize();\n        this._canvas.width = size.x;\n        this._canvas.height = size.y;\n\n        var animated = this._map.options.zoomAnimation && L.Browser.any3d;\n        L.DomUtil.addClass(this._canvas, 'leaflet-zoom-' + (animated ? 'animated' : 'hide'));\n\n\n        map._panes.overlayPane.appendChild(this._canvas);\n\n        map.on(this.getEvents(),this);\n\n        var del = this._delegate || this;\n        del.onLayerDidMount && del.onLayerDidMount(); // -- callback\n        this.needRedraw();\n    },\n\n    //-------------------------------------------------------------\n    onRemove: function (map) {\n        var del = this._delegate || this;\n        del.onLayerWillUnmount && del.onLayerWillUnmount(); // -- callback\n\n\n        map.getPanes().overlayPane.removeChild(this._canvas);\n\n        map.off(this.getEvents(),this);\n\n        this._canvas = null;\n\n    },\n\n    //------------------------------------------------------------\n    addTo: function (map) {\n        map.addLayer(this);\n        return this;\n    },\n    // --------------------------------------------------------------------------------\n    LatLonToMercator: function (latlon) {\n        return {\n            x: latlon.lng * 6378137 * Math.PI / 180,\n            y: Math.log(Math.tan((90 + latlon.lat) * Math.PI / 360)) * 6378137\n        };\n    },\n\n    //------------------------------------------------------------------------------\n    drawLayer: function () {\n        // -- todo make the viewInfo properties  flat objects.\n        var size   = this._map.getSize();\n        var bounds = this._map.getBounds();\n        var zoom   = this._map.getZoom();\n\n        var center = this.LatLonToMercator(this._map.getCenter());\n        var corner = this.LatLonToMercator(this._map.containerPointToLatLng(this._map.getSize()));\n\n        var del = this._delegate || this;\n        del.onDrawLayer && del.onDrawLayer( {\n                                                layer : this,\n                                                canvas: this._canvas,\n                                                bounds: bounds,\n                                                size: size,\n                                                zoom: zoom,\n                                                center : center,\n                                                corner : corner\n                                            });\n        this._frame = null;\n    },\n    // -- L.DomUtil.setTransform from leaflet 1.0.0 to work on 0.0.7\n    //------------------------------------------------------------------------------\n    _setTransform: function (el, offset, scale) {\n        var pos = offset || new L.Point(0, 0);\n\n        el.style[L.DomUtil.TRANSFORM] =\n\t\t\t(L.Browser.ie3d ?\n\t\t\t\t'translate(' + pos.x + 'px,' + pos.y + 'px)' :\n\t\t\t\t'translate3d(' + pos.x + 'px,' + pos.y + 'px,0)') +\n\t\t\t(scale ? ' scale(' + scale + ')' : '');\n    },\n\n    //------------------------------------------------------------------------------\n    _animateZoom: function (e) {\n        var scale = this._map.getZoomScale(e.zoom);\n        // -- different calc of animation zoom  in leaflet 1.0.3 thanks @peterkarabinovic, @jduggan1\n        var offset = L.Layer ? this._map._latLngBoundsToNewLayerBounds(this._map.getBounds(), e.zoom, e.center).min :\n                               this._map._getCenterOffset(e.center)._multiplyBy(-scale).subtract(this._map._getMapPanePos());\n\n        L.DomUtil.setTransform(this._canvas, offset, scale);\n\n\n    }\n});\n\nL.canvasLayer = function () {\n    return new L.CanvasLayer();\n};\n"]}