{"version":3,"sources":["location-field.js"],"names":["LocationField","props","_geocodeAutocomplete","text","config","geocoder","MAPZEN_KEY","baseUrl","boundary","focusPoint","apiKey","sources","url","then","result","setState","geocodedFeatures","features","catch","err","console","error","_onClearButtonClick","type","clearLocation","value","ReactDOM","findDOMNode","formControl","focus","_onDropdownToggle","v","e","targetIsInput","target","className","indexOf","_getFormControlClassname","menuVisible","state","_onTextInputBlur","_onTextInputChange","evt","_onTextInputFocus","currentPosition","nearbyStops","onClick","length","coords","findNearbyStops","lat","latitude","lon","longitude","max","maxNearbyStops","_onKeyDown","isStatic","static","activeIndex","key","preventDefault","menuItemCount","locationSelected","locationSelectedLookup","_geocodeSearch","_useCurrentLocation","getCurrentPosition","onLocationSelected","setLocationToCurrent","fetchingLocation","_geolocationAlert","window","alert","location","host","message","hideExistingValue","name","nextProps","warn","format","log","setLocation","label","showClearButton","suppressNearby","slice","sessionSearches","menuItems","itemIndex","optionIcon","optionTitle","currentLocationOption","createOption","push","concat","map","lonlat","fromCoordinates","feature","geometry","coordinates","properties","_setLocation","addLocationSearch","option","stop","stopsIndex","stopId","createTransitStopOption","placeholder","fetching","textControl","ctl","clearButton","width","InputGroup","Button","Component","propTypes","PropTypes","object","bool","string","array","func","defaultProps","itemKey","icon","title","onSelect","isActive","float","marginLeft","paddingTop","fontSize","dist","code","routes","route","i","shortName","longName","clear","mapStateToProps","ownProps","otp","currentQuery","transitIndex","stops","mapDispatchToProps"],"mappings":"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","file":"location-field.js","sourcesContent":["import lonlat from '@conveyal/lonlat'\nimport React, { Component, PropTypes } from 'react'\nimport ReactDOM from 'react-dom'\nimport { FormGroup, FormControl, InputGroup, DropdownButton, MenuItem } from 'react-bootstrap'\nimport { connect } from 'react-redux'\nimport { autocomplete, search } from 'isomorphic-mapzen-search'\nimport { throttle } from 'throttle-debounce'\n\nimport LocationIcon from '../icons/location-icon'\nimport { setLocation, setLocationToCurrent, clearLocation } from '../../actions/map'\nimport { addLocationSearch, getCurrentPosition } from '../../actions/location'\nimport { findNearbyStops } from '../../actions/api'\nimport { distanceStringImperial } from '../../util/distance'\n\nclass LocationField extends Component {\n  static propTypes = {\n    config: PropTypes.object,\n    currentPosition: PropTypes.object,\n    hideExistingValue: PropTypes.bool,\n    location: PropTypes.object,\n    label: PropTypes.string,\n    nearbyStops: PropTypes.array,\n    sessionSearches: PropTypes.array,\n    showClearButton: PropTypes.bool,\n    static: PropTypes.bool, // show autocomplete options as fixed/inline element rather than dropdown\n    stopsIndex: PropTypes.object,\n    type: PropTypes.string, // replace with locationType?\n\n    // callbacks\n    onClick: PropTypes.func,\n    onLocationSelected: PropTypes.func,\n\n    // dispatch\n    addLocationSearch: PropTypes.func,\n    clearLocation: PropTypes.func,\n    setLocation: PropTypes.func,\n    setLocationToCurrent: PropTypes.func\n  }\n\n  static defaultProps = {\n    showClearButton: true\n  }\n\n  constructor (props) {\n    super(props)\n    this.state = {\n      value: props.location !== null && !props.hideExistingValue\n        ? props.location.name\n        : '',\n      menuVisible: false,\n      geocodedFeatures: [],\n      activeIndex: null\n    }\n  }\n\n  componentWillReceiveProps (nextProps) {\n    if (this.props.location !== nextProps.location) {\n      this.setState({\n        value: nextProps.location !== null ? nextProps.location.name : '',\n        geocodedFeatures: []\n      })\n    }\n  }\n\n  _geocodeAutocomplete = throttle(1000, (text) => {\n    const {MAPZEN_KEY, baseUrl, boundary, focusPoint} = this.props.config.geocoder\n    autocomplete({\n      apiKey: MAPZEN_KEY,\n      boundary,\n      focusPoint,\n      sources: null,\n      text,\n      url: baseUrl ? `${baseUrl}/autocomplete` : null\n    }).then((result) => {\n      this.setState({ geocodedFeatures: result.features })\n    }).catch((err) => {\n      console.error(err)\n    })\n  })\n\n  _geocodeSearch (text) {\n    const { MAPZEN_KEY, baseUrl, boundary, focusPoint } = this.props.config.geocoder\n    if (!text) {\n      console.warn('No text entry provided for geocode search.')\n      return\n    }\n    search({\n      apiKey: MAPZEN_KEY,\n      boundary,\n      focusPoint,\n      text,\n      sources: null,\n      url: baseUrl ? `${baseUrl}/search` : null,\n      format: false // keep as returned GeoJSON\n    }).then((result) => {\n      console.log(`search results (query=${text})`, result)\n      if (result.features && result.features.length > 0) {\n        // Only replace geocode items if results were found\n        this.setState({ geocodedFeatures: result.features })\n      } else {\n        console.warn('No results found for geocode search. Not replacing results.')\n      }\n    }).catch((err) => {\n      console.error(err)\n    })\n  }\n\n  _getFormControlClassname () {\n    return this.props.type + '-form-control'\n  }\n\n  _onClearButtonClick = () => {\n    const { type } = this.props\n    this.props.clearLocation({ type })\n    this.setState({\n      value: '',\n      geocodedFeatures: []\n    })\n    ReactDOM.findDOMNode(this.formControl).focus()\n  }\n\n  _onDropdownToggle = (v, e) => {\n    // if clicked on input form control, keep dropdown open; otherwise, toggle\n    const targetIsInput =\n      e.target.className.indexOf(this._getFormControlClassname()) !== -1\n    const menuVisible = targetIsInput ? true : !this.state.menuVisible\n    this.setState({ menuVisible })\n  }\n\n  _onTextInputBlur = () => this.setState({ menuVisible: false })\n\n  _onTextInputChange = (evt) => {\n    this.setState({ value: evt.target.value })\n    this._geocodeAutocomplete(evt.target.value)\n  }\n\n  _onTextInputFocus = () => {\n    const { config, currentPosition, nearbyStops, onClick } = this.props\n    if (typeof onClick === 'function') onClick()\n    this.setState({ menuVisible: true })\n    if (nearbyStops.length === 0 && currentPosition && currentPosition.coords) {\n      this.props.findNearbyStops({\n        lat: currentPosition.coords.latitude,\n        lon: currentPosition.coords.longitude,\n        max: config.geocoder.maxNearbyStops || 4\n      })\n    }\n  }\n\n  _onKeyDown = (evt) => {\n    const { static: isStatic } = this.props\n    const { activeIndex, menuVisible } = this.state\n    switch (evt.key) {\n      // 'Down' arrow key pressed: move selected menu item down by one position\n      case 'ArrowDown':\n        // Suppress default 'ArrowDown' behavior which moves cursor to end\n        evt.preventDefault()\n        if (!menuVisible && !isStatic) {\n          // If the menu is not visible, simulate a text input click to show it.\n          return this._onTextInputFocus()\n        }\n        if (activeIndex === this.menuItemCount - 1) {\n          return this.setState({ activeIndex: null })\n        }\n        return this.setState({\n          activeIndex: activeIndex === null\n            ? 0\n            : activeIndex + 1\n        })\n\n      // 'Up' arrow key pressed: move selection up by one position\n      case 'ArrowUp':\n        // Suppress default 'ArrowUp' behavior which moves cursor to beginning\n        evt.preventDefault()\n        if (activeIndex === 0) {\n          return this.setState({ activeIndex: null })\n        }\n        return this.setState({\n          activeIndex: activeIndex === null\n            ? this.menuItemCount - 1\n            : activeIndex - 1\n        })\n\n      // 'Enter' keypress serves two purposes:\n      //  - If pressed when typing in search string, switch from 'autocomplete'\n      //    to 'search' geocoding\n      //  - If pressed when dropdown results menu is active, apply the location\n      //    associated with current selected menu item\n      case 'Enter':\n        if (typeof activeIndex === 'number') { // Menu is active\n          // Retrieve location selection handler from lookup object and invoke\n          const locationSelected = this.locationSelectedLookup[activeIndex]\n          if (locationSelected) locationSelected()\n\n          // Clear selection & hide the menu\n          this.setState({\n            menuVisible: false,\n            activeIndex: null\n          })\n        } else { // Menu not active; get geocode 'search' results\n          this._geocodeSearch(evt.target.value)\n          // Ensure menu is visible.\n          this.setState({ menuVisible: true })\n        }\n\n        // Suppress default 'Enter' behavior which causes page to reload\n        evt.preventDefault()\n        break\n      case 'Escape':\n        // Clear selection & hide the menu\n        return this.setState({\n          menuVisible: false,\n          activeIndex: null\n        })\n      // Any other key pressed: clear active selection\n      default:\n        return this.setState({ activeIndex: null })\n    }\n  }\n\n  _setLocation (location) {\n    const { onLocationSelected, setLocation, type } = this.props\n    onLocationSelected && onLocationSelected()\n    setLocation({ type, location })\n  }\n\n  _useCurrentLocation = () => {\n    const {\n      currentPosition,\n      getCurrentPosition,\n      onLocationSelected,\n      setLocationToCurrent,\n      type\n    } = this.props\n    if (currentPosition.coords) {\n      // We already have geolocation coordinates\n      setLocationToCurrent({ type })\n      onLocationSelected && onLocationSelected()\n    } else {\n      // Call geolocation.getCurrentPosition and set as from/to type\n      this.setState({ fetchingLocation: true })\n      getCurrentPosition(type, onLocationSelected)\n    }\n  }\n\n  /**\n   * Provide alert to user with reason for geolocation error\n   */\n  _geolocationAlert = () => {\n    window.alert(\n      `Geolocation either has been disabled for ${window.location.host} or is not available in your browser.\\n\\nReason: ${this.props.currentPosition.error.message || 'Unknown reason'}`\n    )\n  }\n\n  render () {\n    const {\n      currentPosition,\n      label,\n      location,\n      showClearButton,\n      static: isStatic,\n      suppressNearby,\n      type,\n      nearbyStops\n    } = this.props\n\n    const { activeIndex } = this.state\n    let geocodedFeatures = this.state.geocodedFeatures\n    if (geocodedFeatures.length > 5) geocodedFeatures = geocodedFeatures.slice(0, 5)\n\n    let sessionSearches = this.props.sessionSearches\n    if (sessionSearches.length > 5) sessionSearches = sessionSearches.slice(0, 5)\n\n    // Assemble menu contents, to be displayed either as dropdown or static panel.\n    // Menu items are created in four phases: (1) the current location, (2) any\n    // geocoder search results; (3) nearby transit stops; and (4) saved searches\n\n    let menuItems = [] // array of menu items for display (may include non-selectable items e.g. dividers/headings)\n    let itemIndex = 0 // the index of the current location-associated menu item (excluding non-selectable items)\n    this.locationSelectedLookup = {} // maps itemIndex to a location selection handler (for use by the _onKeyDown method)\n\n    /* 1) Process the current location */\n    let locationSelected, optionIcon, optionTitle\n\n    if (!currentPosition.error) { // current position detected successfully\n      locationSelected = this._useCurrentLocation\n      optionIcon = 'location-arrow'\n      optionTitle = 'Use Current Location'\n    } else { // error detecting current position\n      locationSelected = this._geolocationAlert\n      optionIcon = 'ban'\n      optionTitle = 'Current location not available'\n    }\n\n    // Add to the selection handler lookup (for use in _onKeyDown)\n    this.locationSelectedLookup[itemIndex] = locationSelected\n\n    if (!suppressNearby) {\n      // Create and add the option item to the menu items array\n      const currentLocationOption = createOption(optionIcon, optionTitle, locationSelected, itemIndex === activeIndex)\n      menuItems.push(currentLocationOption)\n      itemIndex++\n    }\n\n    /* 2) Process geocode search result option(s) */\n    if (geocodedFeatures.length > 0) {\n      // Add the menu sub-heading (not a selectable item)\n      menuItems.push(<MenuItem header key='sr-header'>Search Results</MenuItem>)\n\n      // Iterate through the geocoder results\n      menuItems = menuItems.concat(geocodedFeatures.map(feature => {\n        // Create the selection handler\n        const locationSelected = () => {\n          // Construct the location\n          const location = lonlat.fromCoordinates(feature.geometry.coordinates)\n          location.name = feature.properties.label\n          // Set the current location\n          this._setLocation(location)\n          // Add to the location search history\n          this.props.addLocationSearch({ location })\n        }\n\n        // Add to the selection handler lookup (for use in _onKeyDown)\n        this.locationSelectedLookup[itemIndex] = locationSelected\n\n        // Create and return the option menu item\n        const option = createOption('map-pin', feature.properties.label, locationSelected, itemIndex === activeIndex)\n        itemIndex++\n        return option\n      }))\n    }\n\n    /* 3) Process nearby transit stop options */\n    if (nearbyStops.length > 0 && !suppressNearby) {\n      // Add the menu sub-heading (not a selectable item)\n      menuItems.push(<MenuItem header key='ns-header'>Nearby Stops</MenuItem>)\n\n      // Iterate through the found nearby stops\n      menuItems = menuItems.concat(nearbyStops.map(stopId => {\n        // Constuct the location\n        const stop = this.props.stopsIndex[stopId]\n        const location = {\n          name: stop.name,\n          lat: stop.lat,\n          lon: stop.lon\n        }\n\n        // Create the location selected handler\n        const locationSelected = () => { this._setLocation(location) }\n\n        // Add to the selection handler lookup (for use in _onKeyDown)\n        this.locationSelectedLookup[itemIndex] = locationSelected\n\n        // Create and return the option menu item\n        const option = createTransitStopOption(stop, locationSelected, itemIndex === activeIndex)\n        itemIndex++\n        return option\n      }))\n    }\n\n    /* 4) Process recent search history options */\n    if (sessionSearches.length > 0) {\n      // Add the menu sub-heading (not a selectable item)\n      menuItems.push(<MenuItem header key='ss-header'>Recently Searched</MenuItem>)\n\n      // Iterate through any saved locations\n      menuItems = menuItems.concat(sessionSearches.map(location => {\n        // Create the location-selected handler\n        const locationSelected = () => { this._setLocation(location) }\n\n        // Add to the selection handler lookup (for use in _onKeyDown)\n        this.locationSelectedLookup[itemIndex] = locationSelected\n\n        // Create and return the option menu item\n        const option = createOption('search', location.name, locationSelected, itemIndex === activeIndex)\n        itemIndex++\n        return option\n      }))\n    }\n\n    // Store the number of location-associated items for reference in the _onKeyDown method\n    this.menuItemCount = itemIndex\n\n    /** the text input element **/\n    const placeholder = currentPosition.fetching === type\n      ? 'Fetching location...'\n      : label || type\n    const textControl = <FormControl\n      autoFocus={isStatic} // focuses the input when the component mounts if static\n      ref={ctl => { this.formControl = ctl }}\n      className={this._getFormControlClassname()}\n      type='text'\n      value={this.state.value}\n      placeholder={placeholder}\n      onBlur={this._onTextInputBlur}\n      onChange={this._onTextInputChange}\n      onFocus={this._onTextInputFocus}\n      onKeyDown={this._onKeyDown}\n    />\n\n    // Only include the clear ('X') button add-on if a location is selected\n    // or if the input field has text.\n    const clearButton = showClearButton && (location || this.state.value)\n      ? <InputGroup.Addon onClick={this._onClearButtonClick}>\n        <i className='fa fa-times' />\n      </InputGroup.Addon>\n      : null\n    if (isStatic) {\n      // 'static' mode (menu is displayed alongside input, e.g., for mobile view)\n      return (\n        <div className='location-field static'>\n          <form>\n            <FormGroup>\n              <InputGroup>\n                <InputGroup.Addon>\n                  <LocationIcon type={type} />\n                </InputGroup.Addon>\n                {textControl}\n                {clearButton}\n              </InputGroup>\n            </FormGroup>\n          </form>\n          <ul className='dropdown-menu' style={{ width: '100%' }}>\n            {menuItems.length > 0 // Show typing prompt to avoid empty screen\n              ? menuItems\n              : <MenuItem header className={'text-center'}>\n                Begin typing to search for locations\n              </MenuItem>\n            }\n          </ul>\n        </div>\n      )\n    } else {\n      // default display mode with dropdown menu\n      return (\n        <form>\n          <FormGroup className='location-field'>\n            <InputGroup>\n              {/* location field icon -- also serves as dropdown anchor */}\n              <DropdownButton\n                componentClass={InputGroup.Button}\n                open={this.state.menuVisible}\n                onToggle={this._onDropdownToggle}\n                id='location-dropdown'\n                title={<LocationIcon type={type} />}\n                noCaret\n              >\n                {menuItems}\n              </DropdownButton>\n              {textControl}\n              {clearButton}\n            </InputGroup>\n          </FormGroup>\n        </form>\n      )\n    }\n  }\n}\n\n// helper functions for dropdown options\n\nlet itemKey = 0\n\nfunction createOption (icon, title, onSelect, isActive) {\n  return <MenuItem className='location-option' onSelect={onSelect} key={itemKey++} active={isActive}>\n    <div>\n      <div style={{ float: 'left' }}><i className={`fa fa-${icon}`} /></div>\n      <div style={{ marginLeft: '30px' }}>{title}</div>\n    </div>\n  </MenuItem>\n}\n\nfunction createTransitStopOption (stop, onSelect, isActive) {\n  return <MenuItem className='location-option' onSelect={onSelect} key={itemKey++} active={isActive}>\n    <div>\n      <div style={{ float: 'left', paddingTop: '3px' }}>\n        <i className='fa fa-bus' style={{ fontSize: '20px' }} />\n        <div style={{ fontSize: '8px' }}>{distanceStringImperial(stop.dist, true)}</div>\n      </div>\n      <div style={{ marginLeft: '30px' }}>\n        <div>{stop.name} ({stop.code})</div>\n        <div style={{ fontSize: '9px' }}>\n          {(stop.routes || []).map((route, i) => {\n            const name = route.shortName || route.longName\n            return (\n              <span key={`route-${i}`} className='route'>\n                {name}\n              </span>\n            )\n          })}\n        </div>\n      </div>\n      <div style={{ clear: 'both' }} />\n    </div>\n  </MenuItem>\n}\n\n// connect to redux store\n\nconst mapStateToProps = (state, ownProps) => {\n  return {\n    config: state.otp.config,\n    location: state.otp.currentQuery[ownProps.type],\n    currentPosition: state.otp.location.currentPosition,\n    sessionSearches: state.otp.location.sessionSearches,\n    nearbyStops: state.otp.location.nearbyStops,\n    stopsIndex: state.otp.transitIndex.stops\n  }\n}\n\nconst mapDispatchToProps = {\n  addLocationSearch,\n  findNearbyStops,\n  getCurrentPosition,\n  setLocation,\n  setLocationToCurrent,\n  clearLocation\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(LocationField)\n"]}