{"version":3,"sources":["transit-leg-body.js"],"names":["TransitLegBody","props","_onToggleStopsClick","setState","stopsExpanded","state","_onToggleAlertsClick","alertsExpanded","_onSummaryClick","setActiveLeg","legIndex","leg","customIcons","alerts","mode","routeShortName","routeLongName","headsign","iconMode","customModeForLeg","customMode","fontWeight","length","pluralize","animation","intermediateStops","duration","tripId","from","stopIndex","to","averageWait","Component","propTypes","PropTypes","object","number","func","RouteName","key","IntermediateStops","stops","map","stop","k","name","array","AlertsBody","sort","a","b","effectiveStartDate","alert","effectiveDateString","daysAway","diff","Math","abs","format","calendar","sameElse","split","alertDescriptionText","str","list"],"mappings":"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","file":"transit-leg-body.js","sourcesContent":["import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport { VelocityTransitionGroup } from 'velocity-react'\nimport moment from 'moment'\n\nimport ViewTripButton from '../../viewers/view-trip-button'\nimport { getModeIcon } from '../../../util/itinerary'\nimport { formatDuration } from '../../../util/time'\n\n// TODO: support multi-route legs for profile routing\n\nexport default class TransitLegBody extends Component {\n\n  static propTypes = {\n    leg: PropTypes.object,\n    legIndex: PropTypes.number,\n    setActiveLeg: PropTypes.func\n  }\n\n  constructor (props) {\n    super(props)\n    this.state = {\n      alertsExpanded: false,\n      stopsExpanded: false\n    }\n  }\n\n  _onToggleStopsClick = () => {\n    this.setState({ stopsExpanded: !this.state.stopsExpanded })\n  }\n\n  _onToggleAlertsClick = () => {\n    this.setState({ alertsExpanded: !this.state.alertsExpanded })\n  }\n\n  _onSummaryClick = () => {\n    this.props.setActiveLeg(this.props.legIndex, this.props.leg)\n  }\n\n  render () {\n    const { customIcons, leg } = this.props\n    const { alerts, mode, routeShortName, routeLongName, headsign } = leg\n    const { alertsExpanded, stopsExpanded } = this.state\n\n    let iconMode = mode\n    if (typeof customIcons.customModeForLeg === 'function') {\n      const customMode = customIcons.customModeForLeg(leg)\n      if (customMode) iconMode = customMode\n    }\n\n    return (\n      <div className='leg-body'>\n        {/* The Route Icon/Name Bar; clickable to set as active leg */}\n        <div className='summary' onClick={this._onSummaryClick}>\n          <div className='route-name leg-description'>\n            <div>\n              <div className='icon'>{getModeIcon(iconMode, customIcons)}</div>\n            </div>\n            {routeShortName && (\n              <div>\n                <span className='route-short-name'>{routeShortName}</span>\n              </div>\n            )}\n            <div className='route-long-name'>\n              {routeLongName}\n              {headsign && <span> <span style={{ fontWeight: '200' }}>to</span> {headsign}</span>}\n            </div>\n          </div>\n        </div>\n\n        {/* Alerts toggle */}\n        {alerts && alerts.length > 0 && (\n          <div onClick={this._onToggleAlertsClick} className='transit-alerts-toggle'>\n            <i className='fa fa-exclamation-triangle' /> {alerts.length} {pluralize('alert', alerts)}\n            {' '}\n            <i className={`fa fa-caret-${this.state.alertsExpanded ? 'up' : 'down'}`} />\n          </div>\n        )}\n\n        {/* The Alerts body, if visible */}\n        <VelocityTransitionGroup enter={{animation: 'slideDown'}} leave={{animation: 'slideUp'}}>\n          {alertsExpanded && <AlertsBody alerts={leg.alerts} />}\n        </VelocityTransitionGroup>\n\n        {/* The \"Ride X Min / X Stops\" Row, including IntermediateStops body */}\n        {leg.intermediateStops && leg.intermediateStops.length > 0 && (\n          <div className='transit-leg-details'>\n\n            {/* The header summary row, clickable to expand intermediate stops */}\n            <div onClick={this._onToggleStopsClick} className='header'>\n              {leg.duration && <span>Ride {formatDuration(leg.duration)}</span>}\n              {leg.intermediateStops && (\n                <span>\n                  {' / '}\n                  {leg.intermediateStops.length + 1}\n                  {' stops '}\n                  <i className={`fa fa-caret-${this.state.stopsExpanded ? 'up' : 'down'}`} />\n                </span>\n              )}\n\n              {/* The ViewTripButton. TODO: make configurable */}\n              <ViewTripButton\n                tripId={leg.tripId}\n                fromIndex={leg.from.stopIndex}\n                toIndex={leg.to.stopIndex}\n              />\n            </div>\n\n            {/* IntermediateStops expanded body */}\n            <VelocityTransitionGroup enter={{animation: 'slideDown'}} leave={{animation: 'slideUp'}}>\n              {stopsExpanded ? <IntermediateStops stops={leg.intermediateStops} /> : null }\n            </VelocityTransitionGroup>\n\n            {/* Average wait details, if present */}\n            {leg.averageWait && <span>Typical Wait: {formatDuration(leg.averageWait)}</span>}\n          </div>\n        )}\n      </div>\n    )\n  }\n}\n\nclass RouteName extends Component {\n  render () {\n    const { routeShortName, routeLongName, headsign, key, customIcons } = this.props\n\n    return (\n      <div key={key} className='route-name leg-description'> {/* Route Name/Badge row; clickable to set as active leg */}\n        <div>\n          <div className='icon'>{getModeIcon(mode, customIcons)}</div>\n        </div>\n        {routeShortName && (\n          <div>\n            <span className='route-short-name'>{routeShortName}</span>\n          </div>\n        )}\n        <div className='route-long-name'>\n          {routeLongName}\n          {headsign && <span> <span style={{ fontWeight: '200' }}>to</span> {headsign}</span>}\n        </div>\n      </div>\n    )\n  }\n}\n\nclass IntermediateStops extends Component {\n  static propTypes = {\n    stops: PropTypes.array\n  }\n\n  render () {\n    return (\n      <div className='intermediate-stops'>\n        {this.props.stops.map((stop, k) => {\n          return <div className='stop-row' key={k}>\n            <div className='stop-marker'>&bull;</div>\n            <div className='stop-name'>{stop.name}</div>\n          </div>\n        })}\n      </div>\n    )\n  }\n}\n\nclass AlertsBody extends Component {\n  static propTypes = {\n    alerts: PropTypes.array\n  }\n\n  render () {\n    return (\n      <div className='transit-alerts'>\n        {this.props.alerts.sort((a, b) => (a.effectiveStartDate < b.effectiveStartDate) ? 1 : -1).map((alert, k) => {\n          const effectiveStartDate = moment(alert.effectiveStartDate)\n          let effectiveDateString = 'Effective as of '\n          const daysAway = moment().diff(effectiveStartDate, 'days')\n          if (Math.abs(daysAway) <= 1) effectiveDateString += moment(effectiveStartDate).format('h:MMa, ')\n          effectiveDateString += effectiveStartDate.calendar(null, { sameElse: 'MMMM D, YYYY' }).split(' at')[0]\n          return (\n            <div key={k} className='transit-alert'>\n              <div className='alert-icon'><i className='fa fa-exclamation-triangle' /></div>\n              <div className='alert-body'>{alert.alertDescriptionText}</div>\n              <div className='effective-date'>{effectiveDateString}</div>\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n}\n\n// TODO use pluralize that for internationalization (and complex plurals, i.e., not just adding 's')\nfunction pluralize (str, list) {\n  return `${str}${list.length > 1 ? 's' : ''}`\n}\n"]}