{"version":3,"sources":["tabbed-itineraries.js"],"names":["TabbedItineraries","_toggleRealtimeItineraryClick","e","props","setUseRealtimeResponse","useRealtime","activeItinerary","companies","itineraries","itineraryClass","realtimeEffects","tnc","map","itinerary","index","classNames","caloriesBurned","centsToString","maxTNCFare","minTNCFare","transitFare","minTotalFare","plus","push","join","setActiveItinerary","duration","transfers","Math","round","isAffectedByRealtimeData","exceedsThreshold","routesDiffer","React","createElement","key","active","routingType","Component","propTypes","PropTypes","array","func","pending","bool","number","setActiveLeg","setActiveStep","defaultProps","DefaultItinerary","mapStateToProps","state","ownProps","activeSearch","otp","activeLeg","activeStep","currentQuery","mapDispatchToProps","dispatch","leg","step"],"mappings":"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","file":"tabbed-itineraries.js","sourcesContent":["import React, { Component, PropTypes } from 'react'\nimport { connect } from 'react-redux'\nimport { Button } from 'react-bootstrap'\n\nimport { setActiveItinerary, setActiveLeg, setActiveStep, setUseRealtimeResponse } from '../../actions/narrative'\nimport DefaultItinerary from './default/default-itinerary'\nimport Icon from './icon'\nimport { getActiveItineraries, getActiveSearch, getRealtimeEffects } from '../../util/state'\nimport RealtimeAnnotation from './realtime-annotation'\nimport { calculateFares, calculatePhysicalActivity } from '../../util/itinerary'\nimport { formatDuration } from '../../util/time'\n\nclass TabbedItineraries extends Component {\n  static propTypes = {\n    itineraries: PropTypes.array,\n    itineraryClass: PropTypes.func,\n    pending: PropTypes.bool,\n    activeItinerary: PropTypes.number,\n    setActiveItinerary: PropTypes.func,\n    setActiveLeg: PropTypes.func,\n    setActiveStep: PropTypes.func,\n    setUseRealtimeResponse: PropTypes.func,\n    useRealtime: PropTypes.bool\n  }\n\n  static defaultProps = {\n    itineraryClass: DefaultItinerary\n  }\n\n  _toggleRealtimeItineraryClick = (e) => {\n    const { setUseRealtimeResponse, useRealtime } = this.props\n    setUseRealtimeResponse({ useRealtime: !useRealtime })\n  }\n\n  render () {\n    const {\n      activeItinerary,\n      companies,\n      itineraries,\n      itineraryClass,\n      realtimeEffects,\n      tnc,\n      useRealtime\n    } = this.props\n    if (!itineraries) return null\n\n    return (\n      <div className='options itinerary tabbed-itineraries'>\n        <div className='tab-row'>\n          {itineraries.map((itinerary, index) => {\n            const classNames = ['tab-button', 'clear-button-formatting']\n            const { caloriesBurned } = calculatePhysicalActivity(itinerary)\n            const {\n              centsToString,\n              maxTNCFare,\n              minTNCFare,\n              transitFare\n            } = calculateFares(itinerary)\n            // TODO: support non-USD\n            let minTotalFare = minTNCFare * 100 + transitFare\n            const plus = maxTNCFare && maxTNCFare > minTNCFare ? '+' : ''\n            if (index === activeItinerary) classNames.push('selected')\n            return (\n              <Button\n                key={`tab-button-${index}`}\n                className={classNames.join(' ')}\n                onClick={() => { this.props.setActiveItinerary(index) }}\n              >\n                <div className='title'>{index === 0\n                  ? <span>Best Bet</span>\n                  : <span>Option {index + 1}</span>\n                }</div>\n                <div className='details'>\n                  {formatDuration(itinerary.duration)}\n                  {itinerary.transfers > 0 && (\n                    <span><br />{itinerary.transfers} transfer{itinerary.transfers > 1 ? 's' : ''}</span>\n                  )}\n                  <span>\n                    <br />{minTotalFare ? `${centsToString(minTotalFare)}${plus} ` : ''}\n                    {Math.round(caloriesBurned)} Cal\n                  </span>\n                </div>\n              </Button>\n            )\n          })}\n        </div>\n\n        {/* TODO: should this be moved? */}\n        {realtimeEffects.isAffectedByRealtimeData && (\n          realtimeEffects.exceedsThreshold ||\n          realtimeEffects.routesDiffer ||\n          !useRealtime) && (\n          <RealtimeAnnotation\n            realtimeEffects={realtimeEffects}\n            toggleRealtime={this._toggleRealtimeItineraryClick}\n            useRealtime={useRealtime} />\n          )\n        }\n\n        {/* Show the active itinerary */}\n        {(activeItinerary !== null) && React.createElement(itineraryClass, {\n          itinerary: itineraries[activeItinerary],\n          index: activeItinerary,\n          key: activeItinerary,\n          active: true,\n          routingType: 'ITINERARY',\n          ...this.props\n        })}\n\n      </div>\n    )\n  }\n}\n\n// connect to the redux store\n\nconst mapStateToProps = (state, ownProps) => {\n  const activeSearch = getActiveSearch(state.otp)\n  // const { activeItinerary, activeLeg, activeStep } = activeSearch ? activeSearch.activeItinerary : {}\n  const pending = activeSearch ? activeSearch.pending : false\n  const itineraries = getActiveItineraries(state.otp)\n  const realtimeEffects = getRealtimeEffects(state.otp)\n  const useRealtime = state.otp.useRealtime\n  return {\n    // swap out realtime itineraries with non-realtime depending on boolean\n    itineraries,\n    pending,\n    realtimeEffects,\n    activeItinerary: activeSearch && activeSearch.activeItinerary,\n    activeLeg: activeSearch && activeSearch.activeLeg,\n    activeStep: activeSearch && activeSearch.activeStep,\n    useRealtime,\n    companies: state.otp.currentQuery.companies,\n    tnc: state.otp.tnc\n  }\n}\n\nconst mapDispatchToProps = (dispatch, ownProps) => {\n  return {\n    setActiveItinerary: index => {\n      dispatch(setActiveItinerary({index}))\n    },\n    setActiveLeg: (index, leg) => {\n      dispatch(setActiveLeg({index, leg}))\n    },\n    setActiveStep: (index, step) => {\n      dispatch(setActiveStep({index, step}))\n    },\n    setUseRealtimeResponse: ({useRealtime}) => {\n      dispatch(setUseRealtimeResponse({useRealtime}))\n    }\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(\n  TabbedItineraries\n)\n"]}